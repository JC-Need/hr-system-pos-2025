{% extends 'employees/base.html' %}
{% load humanize %}

{% block content %}
<style>
    /* üåø ‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß Borcelle (Green Minimal) */
    :root {
        --theme-color: #2C5F2D;
        --theme-light: #E8F5E9;
    }
    .text-theme { color: var(--theme-color) !important; }
    .bg-theme { background-color: var(--theme-color) !important; color: white !important; }
    .bg-theme-light { background-color: var(--theme-light) !important; }
    .btn-theme { background-color: var(--theme-color); color: white; border: none; }
    .btn-theme:hover { background-color: #1e4220; color: white; }
    .border-theme { border-color: var(--theme-color) !important; }
    
    /* üìÑ ‡∏à‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 */
    .a4-paper {
        background: white;
        width: 210mm;
        min-height: 297mm;
        margin: 0 auto;
        padding: 30px 40px;
        position: relative;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    
    @media print {
        body { background: white; -webkit-print-color-adjust: exact; }
        .d-print-none { display: none !important; }
        .container { max-width: 100% !important; width: 100% !important; padding: 0 !important; margin: 0 !important; }
        .a4-paper { box-shadow: none; margin: 0; width: 100%; padding: 20px 30px; }
        .bg-theme { background-color: var(--theme-color) !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
</style>

<div class="container mt-4 mb-5">
    
    <div class="d-flex justify-content-between mb-4 d-print-none">
        <a href="{% url 'quotation_list' %}" class="btn btn-secondary shadow-sm rounded-pill px-4">
            <i class="fas fa-arrow-left me-2"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </a>
        
        <div>
            {% if qt.status == 'DRAFT' %}
            <a href="{% url 'quotation_edit' qt.id %}" class="btn btn-warning text-white shadow-sm rounded-pill px-4 me-2">
                <i class="fas fa-pen me-2"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </a>
            {% endif %}

            <button onclick="window.print()" class="btn btn-theme shadow-sm rounded-pill px-4">
                <i class="fas fa-print me-2"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (A4)
            </button>
        </div>
    </div>

    <div class="a4-paper">
        
        <div class="row mb-3 align-items-start">
            <div class="col-7">
                <div class="d-flex align-items-center mb-2">
                    {% if company.logo %}
                        <img src="{{ company.logo.url }}" alt="Logo" style="height: 50px; margin-right: 12px;">
                    {% else %}
                        <div class="bg-theme text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; margin-right: 12px;">
                            <i class="fas fa-coffee fa-lg"></i>
                        </div>
                    {% endif %}
                    
                    <div>
                        <h3 class="fw-bold text-theme m-0 lh-1">{{ company.name_th }}</h3>
                        {% if company.name_en %}
                            <small class="text-muted text-uppercase" style="font-size: 0.75rem; letter-spacing: 1px;">{{ company.name_en }}</small>
                        {% endif %}
                    </div>
                </div>
                
                <div class="small text-secondary ps-2 border-start border-3 border-theme" style="font-size: 0.85rem; line-height: 1.4;">
                    <p class="mb-0">{{ company.address }}</p>
                    <p class="mb-0">‡πÇ‡∏ó‡∏£: {{ company.phone }} | Tax ID: {{ company.tax_id }}</p>
                    {% if company.email %}<p class="mb-0">Email: {{ company.email }}</p>{% endif %}
                </div>
            </div>

            <div class="col-5 text-end">
                <h6 class="text-secondary text-uppercase mb-0" style="letter-spacing: 2px; font-size: 0.7rem;">Quotation</h6>
                <h2 class="fw-bold text-theme mb-2">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</h2>
                <table class="table table-sm table-borderless small mb-0 float-end" style="width: auto; font-size: 0.85rem;">
                    <tr>
                        <td class="text-end text-muted py-0">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà (No.):</td>
                        <td class="text-end fw-bold py-0">{{ qt.qt_number }}</td>
                    </tr>
                    <tr>
                        <td class="text-end text-muted py-0">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (Date):</td>
                        <td class="text-end fw-bold py-0">{{ qt.date|date:"d M Y" }}</td>
                    </tr>
                    <tr>
                        <td class="text-end text-muted py-0">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡∏∂‡∏á:</td>
                        <td class="text-end fw-bold py-0">{{ qt.valid_until|date:"d M Y" }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-12">
                <div class="p-2 px-3 bg-theme-light rounded-3 d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-theme fw-bold small mb-1">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Customer): <span class="text-dark fs-6">{{ qt.customer_name }}</span></h6>
                        <p class="mb-0 small text-muted" style="line-height: 1.2;">{{ qt.customer_address|linebreaksbr }}</p>
                    </div>
                    <div class="text-end">
                         <p class="mb-0 small"><strong>‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ:</strong> {{ qt.customer_tax_id|default:"-" }}</p>
                    </div>
                </div>
            </div>
        </div>

        <table class="table table-hover mb-4" style="border-bottom: 2px solid var(--theme-color);">
            <thead class="bg-theme text-white">
                <tr>
                    <th class="py-1 text-center" style="width: 5%;">#</th>
                    <th class="py-1" style="width: 50%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Description)</th>
                    <th class="py-1 text-center" style="width: 10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                    <th class="py-1 text-end" style="width: 15%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                    <th class="py-1 text-end" style="width: 20%;">‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô</th>
                </tr>
            </thead>
            <tbody>
                {% for item in qt.items.all %}
                <tr>
                    <td class="text-center text-muted py-2">{{ forloop.counter }}</td>
                    <td class="fw-bold text-theme py-2">{{ item.product.name }}</td>
                    <td class="text-center py-2">{{ item.quantity }}</td>
                    <td class="text-end py-2">{{ item.unit_price|intcomma }}</td>
                    <td class="text-end fw-bold py-2">{{ item.total_price|intcomma }}</td>
                </tr>
                {% endfor %}
                
                {% if qt.items.count < 8 %}
                <tr><td colspan="5" style="height: 30px;"></td></tr>
                {% endif %}
            </tbody>
        </table>

        <div class="row mb-5">
            <div class="col-7">
                <div class="small text-muted">
                    <p class="fw-bold mb-1 text-theme">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</p>
                    <ul class="ps-3 mb-0" style="font-size: 0.85rem;">
                        <li>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ï‡∏≤‡∏°‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ</li>
                        <li>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</li>
                    </ul>
                </div>
            </div>
            <div class="col-5">
                <table class="table table-borderless table-sm">
                    <tr>
                        <td class="text-end text-muted py-0">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Subtotal)</td>
                        <td class="text-end fw-bold py-0">{{ qt.subtotal|intcomma }}</td>
                    </tr>
                    <tr>
                        <td class="text-end text-muted py-0">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7% (VAT)</td>
                        <td class="text-end text-danger py-0">{{ qt.vat_amount|intcomma }}</td>
                    </tr>
                    <tr style="border-top: 1px solid var(--theme-color); border-bottom: 2px solid var(--theme-color);">
                        <td class="text-end fw-bold text-theme py-1 fs-6">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Grand Total)</td>
                        <td class="text-end fw-bold text-theme py-1 fs-6">{{ qt.grand_total|intcomma }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="row mt-auto pt-5" style="margin-top: 30px;">
            <div class="col-6 text-center">
                <div style="border-bottom: 1px dashed #ccc; width: 70%; margin: 0 auto 10px;"></div>
                <p class="fw-bold text-theme mb-0 small">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Buyer)</p>
                <p class="small text-muted" style="font-size: 0.75rem;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ______/______/______</p>
            </div>
            <div class="col-6 text-center">
                <div style="border-bottom: 1px dashed #ccc; width: 70%; margin: 0 auto 10px;"></div>
                <p class="fw-bold text-theme mb-0 small">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (Authorized Signature)</p>
                <p class="small text-muted" style="font-size: 0.75rem;">{{ company.name_th }}</p>
            </div>
        </div>
        
        <div class="text-center mt-4 border-top pt-2">
            <p class="small text-muted mb-0" style="font-size: 0.7rem;">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (Thank you for your business)</p>
        </div>

    </div>
</div>
{% endblock %}