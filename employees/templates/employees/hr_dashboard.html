{% extends 'employees/base.html' %}
{% load humanize %}

{% block content %}
<div class="container-fluid mt-4 pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold text-success"><i class="fas fa-users me-2"></i>HR Dashboard</h3>
            <p class="text-muted small">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• - {{ today|date:"d M Y" }}</p>
        </div>
        <div>
            <a href="{% url 'employee_detail' request.user.employee.id|default:0 %}" class="btn btn-warning fw-bold rounded-pill shadow-sm text-dark me-1">
                <i class="fas fa-id-card me-1"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
            </a>
            <a href="/admin/employees/employee/" target="_blank" class="btn btn-info text-white rounded-pill fw-bold shadow-sm">
                <i class="fas fa-user-edit me-2"></i> ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
            </a>
        </div>
    </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card bg-white border-bottom border-4 border-primary shadow-sm h-100 py-3">
                <div class="card-body text-center">
                    <h2 class="fw-bold text-primary mb-0">{{ total_employees }}</h2>
                    <small class="text-muted">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏ô)</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-white border-bottom border-4 border-success shadow-sm h-100 py-3">
                <div class="card-body text-center">
                    <h2 class="fw-bold text-success mb-0">‡∏ø{{ total_salary }}</h2>
                    <small class="text-muted">‡∏á‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-white border-bottom border-4 border-warning shadow-sm h-100 py-3 position-relative">
                <div class="card-body text-center">
                    <h2 class="fw-bold text-warning mb-0">{{ pending_leaves }}</h2>
                    <small class="text-muted">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏•‡∏≤ (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</small>
                    {% if pending_leaves > 0 %}<a href="{% url 'leave_approval' %}" class="stretched-link"></a>{% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-white border-bottom border-4 border-danger shadow-sm h-100 py-3">
                <div class="card-body text-center">
                    <h2 class="fw-bold text-danger mb-0">{{ absent_today }}</h2>
                    <small class="text-muted">‡∏Ç‡∏≤‡∏î/‡∏•‡∏≤ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏Ñ‡∏ô)</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3 bg-white"><h6 class="m-0 fw-bold text-primary">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á)</h6></div>
                <div class="card-body"><canvas id="barChart" height="300"></canvas></div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3 bg-white"><h6 class="m-0 fw-bold text-info">‚è∞ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h6></div>
                <div class="card-body text-center">
                    <canvas id="pieChart" height="200"></canvas>
                    <div class="mt-3 small">
                        <span class="me-2"><i class="fas fa-circle text-success"></i> ‡∏õ‡∏Å‡∏ï‡∏¥</span>
                        <span class="me-2"><i class="fas fa-circle text-warning"></i> ‡∏™‡∏≤‡∏¢</span>
                        <span class="me-2"><i class="fas fa-circle text-danger"></i> ‡∏Ç‡∏≤‡∏î/‡∏•‡∏≤</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-header bg-white py-3"><h6 class="m-0 fw-bold text-secondary">‚è≥ ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h6></div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-secondary small">
                    <tr><th class="ps-4">‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th><th>‡πÅ‡∏ú‡∏ô‡∏Å</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
                </thead>
                <tbody>
                    {% for act in activities %}
                    <tr>
                        <td class="ps-4 fw-bold">{{ act.time }}</td>
                        <td>{{ act.title }}</td>
                        <td><span class="badge bg-light text-dark border">{{ act.dept }}</span></td>
                        <td><span class="badge {% if act.is_late %}bg-warning text-dark{% else %}bg-success{% endif %}">{{ act.detail }}</span></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" class="text-center py-4 text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Attendance Bar Chart
    new Chart(document.getElementById("barChart"), {
        type: 'bar',
        data: {
            labels: JSON.parse('{{ bar_labels|safe }}'),
            datasets: [{
                label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô",
                backgroundColor: "#4e73df",
                data: JSON.parse('{{ bar_data|safe }}'),
                borderRadius: 5
            }]
        },
        options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
    });

    // Status Pie Chart
    new Chart(document.getElementById("pieChart"), {
        type: 'doughnut',
        data: {
            labels: ["‡∏õ‡∏Å‡∏ï‡∏¥", "‡∏™‡∏≤‡∏¢", "‡∏Ç‡∏≤‡∏î/‡∏•‡∏≤"],
            datasets: [{
                data: JSON.parse('{{ pie_data|safe }}'),
                backgroundColor: ['#1cc88a', '#f6c23e', '#e74a3b'],
                borderWidth: 0
            }]
        },
        options: { maintainAspectRatio: false, cutout: '70%' }
    });
</script>
{% endblock %}