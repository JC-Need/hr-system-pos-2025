{% extends 'employees/base.html' %}
{% load humanize %}

{% block content %}
<div class="container-fluid mt-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-{{ theme_color }}">
            {{ page_title }}
        </h2>
        
        <div class="btn-group shadow-sm">
            <a href="?type=FG" class="btn btn-{% if view_type == 'FG' %}success{% else %}outline-secondary{% endif %}">
                <i class="fas fa-box"></i> สินค้าขาย
            </a>
            <a href="?type=RM" class="btn btn-{% if view_type == 'RM' %}warning{% else %}outline-secondary{% endif %}">
                <i class="fas fa-layer-group"></i> วัตถุดิบ
            </a>
        </div>
    </div>
    
    <div class="mb-3 text-end">
        <a href="{% url 'product_create' %}?type={{ view_type }}" class="btn btn-{{ theme_color }} shadow">
            <i class="fas fa-plus"></i> เพิ่ม{{ page_title }}ใหม่
        </a>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-primary text-white h-100">
                <div class="card-body">
                    <h6 class="text-uppercase opacity-75">มูลค่าสินค้าคงคลัง (Total Value)</h6>
                    <h2 class="fw-bold mb-0">฿{{ total_value|intcomma }}</h2>
                    <small>คำนวณจากราคาทุน (Cost Price)</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-danger text-white h-100">
                <div class="card-body">
                    <h6 class="text-uppercase opacity-75">สินค้าใกล้หมด (Low Stock)</h6>
                    <h2 class="fw-bold mb-0">{{ low_stock_count }} รายการ</h2>
                    <small>ต่ำกว่าจุดแจ้งเตือนที่ตั้งไว้</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-white h-100 border-start border-4 border-success">
                <div class="card-body">
                    <h6 class="text-uppercase text-success fw-bold">รายการสินค้าทั้งหมด</h6>
                    <h2 class="fw-bold mb-0 text-dark">{{ total_items }} SKU</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow border-0">
        <div class="card-header bg-white py-3">
            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-list me-1"></i> รายการสินค้าในคลัง</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="ps-4">ชื่อสินค้า</th>
                            <th>หมวดหมู่</th>
                            <th>ซัพพลายเออร์</th>
                            <th class="text-end">ทุน (Cost)</th>
                            <th class="text-end">ราคาขาย (Price)</th>
                            <th class="text-center">คงเหลือ</th>
                            <th class="text-center">สถานะ</th>
                            <th class="text-end pe-4">แก้ไข</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in products %}
                        <tr class="{% if p.stock <= p.alert_level %}table-danger{% endif %}">
                            <td class="ps-4">
                                <div class="fw-bold text-dark">{{ p.name }}</div>
                                <small class="text-muted"><i class="fas fa-barcode me-1"></i>{{ p.barcode|default:"-" }}</small>
                            </td>
                            <td><span class="badge bg-light text-dark border">{{ p.category.name|default:"ทั่วไป" }}</span></td>
                            <td><small>{{ p.supplier.name|default:"-" }}</small></td>
                            <td class="text-end text-muted">฿{{ p.cost_price|intcomma }}</td>
                            <td class="text-end fw-bold text-primary">฿{{ p.price|intcomma }}</td>
                            
                            <td class="text-center">
                                <span class="badge rounded-pill fs-6 {% if p.stock <= p.alert_level %}bg-danger{% else %}bg-success{% endif %}">
                                    {{ p.stock }}
                                </span>
                            </td>

                            <td class="text-center">
                                {% if p.stock == 0 %}
                                    <span class="badge bg-dark">สินค้าหมด</span>
                                {% elif p.stock <= p.alert_level %}
                                    <span class="badge bg-warning text-dark">เติมด่วน</span>
                                {% else %}
                                    <span class="badge bg-info text-dark">ปกติ</span>
                                {% endif %}
                            </td>
                            
                            <td class="text-end pe-4">
                                <a href="{% url 'product_edit' p.id %}" class="btn btn-sm btn-outline-primary bg-white shadow-sm">
                                    <i class="fas fa-pen"></i>
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" class="text-center py-5 text-muted">
                                <i class="fas fa-box-open fa-3x mb-3 text-gray-300"></i><br>
                                ยังไม่มีสินค้าในระบบ
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
