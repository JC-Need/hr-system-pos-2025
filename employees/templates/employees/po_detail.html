{% extends 'employees/base.html' %}
{% load humanize %}

{% block content %}
<div class="container-fluid mt-4 px-4">
    
    <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-4 rounded shadow-sm border-start border-5 border-primary">
        <div>
            <h5 class="text-muted mb-1">‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Purchase Order)</h5>
            <h2 class="fw-bold text-primary m-0">#{{ po.po_number }}</h2>
        </div>
        <div class="text-end">
            <h5 class="fw-bold mb-1">{{ po.supplier.name }}</h5>
            <p class="mb-0 text-muted">
                <i class="fas fa-calendar-alt me-1"></i> {{ po.order_date|date:"d M Y" }} | 
                <i class="fas fa-user-tie me-1"></i> {{ po.created_by.first_name }}
            </p>
        </div>
        <div class="ms-4">
            {% if po.status == 'PENDING' %}
                <span class="badge bg-warning text-dark fs-5 px-4 py-2 rounded-pill shadow-sm">
                    <i class="fas fa-clock me-2"></i>‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á
                </span>
            {% else %}
                <span class="badge bg-success fs-5 px-4 py-2 rounded-pill shadow-sm">
                    <i class="fas fa-check-circle me-2"></i>‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
                </span>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="m-0 fw-bold"><i class="fas fa-list me-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</h5>
                </div>
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4 py-3">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th class="text-center">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th class="text-end">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th class="text-end">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th class="text-end pe-4">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in po.items.all %}
                            <tr>
                                <td class="ps-4 fw-bold text-dark">{{ item.product.name }}</td>
                                <td class="text-center">
                                    {% if item.product.product_type == 'RM' %}
                                        <span class="badge bg-warning text-dark">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</span>
                                    {% else %}
                                        <span class="badge bg-success">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</span>
                                    {% endif %}
                                </td>
                                <td class="text-end fs-5">{{ item.quantity|intcomma }}</td>
                                <td class="text-end text-muted">{{ item.unit_price|intcomma }}</td>
                                <td class="text-end pe-4 fw-bold text-primary fs-5">{{ item.total_price|intcomma }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-5 text-muted bg-light">
                                    <i class="fas fa-box-open fa-3x mb-3 text-secondary"></i><br>
                                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <br>
                                    <small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ üëâ</small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="bg-light">
                            <tr>
                                <td colspan="4" class="text-end fw-bold pt-3 fs-5">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</td>
                                <td class="text-end fw-bold fs-4 text-success pe-4 pt-3">‡∏ø{{ po.total_amount|intcomma }}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <a href="{% url 'po_list' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </a>

            {% if po.status == 'PENDING' and po.items.count > 0 %}
            <div class="card shadow-sm border-success mt-4 mb-5">
                <div class="card-body text-center p-4 bg-success bg-opacity-10">
                    <h4 class="fw-bold text-success mb-3">üöö ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?</h4>
                    <p class="text-muted">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
                    <a href="{% url 'po_receive' po.id %}" class="btn btn-success btn-lg px-5 py-3 rounded-pill shadow fw-bold hover-scale" 
                       onclick="return confirm('‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤? \n\n‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!');">
                        <i class="fas fa-dolly me-2"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å (Confirm Receive)
                    </a>
                </div>
            </div>
            {% endif %}
        </div>

        {% if po.status == 'PENDING' %}
        <div class="col-lg-4">
            <div class="card shadow border-0 sticky-top" style="top: 20px; z-index: 1;">
                <div class="card-header bg-dark text-white py-3">
                    <h5 class="m-0 fw-bold"><i class="fas fa-plus-circle me-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h5>
                </div>
                <div class="card-body p-4 bg-light">
                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                            <select name="product_id" class="form-select form-select-lg" required>
                                <option value="" selected disabled>-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>
                                {% for p in products %}
                                <option value="{{ p.id }}">
                                    {{ p.name }} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {{ p.stock }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label fw-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</label>
                                <input type="number" name="quantity" class="form-control form-control-lg" placeholder="0" step="0.01" required>
                            </div>
                            <div class="col-6 mb-3">
                                <label class="form-label fw-bold">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                                <input type="number" name="price" class="form-control form-control-lg" placeholder="0.00" step="0.01" required>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-dark w-100 btn-lg rounded-pill shadow-sm hover-scale">
                            <i class="fas fa-plus me-2"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ö‡∏¥‡∏•
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
    .hover-scale:hover {
        transform: scale(1.02);
        transition: transform 0.2s;
    }
</style>
{% endblock %}

